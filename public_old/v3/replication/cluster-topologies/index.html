<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.103.1" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/csm-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/csm-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/csm-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/csm-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-192x192.png" sizes="192x192">

<title>Cluster Topologies | Dell Technologies</title>
<meta name="description" content="Supported Cluster Topologies with CSM Replication
">
<meta property="og:title" content="Cluster Topologies" />
<meta property="og:description" content="Supported Cluster Topologies with CSM Replication
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dell.github.io/csm-docs/v3/replication/cluster-topologies/" /><meta property="article:section" content="v3" />

<meta property="article:modified_time" content="2022-03-23T08:15:39-04:00" /><meta property="og:site_name" content="Dell Technologies" />

<meta itemprop="name" content="Cluster Topologies">
<meta itemprop="description" content="Supported Cluster Topologies with CSM Replication
">
<meta itemprop="dateModified" content="2022-03-23T08:15:39-04:00" />
<meta itemprop="wordCount" content="705">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cluster Topologies"/>
<meta name="twitter:description" content="Supported Cluster Topologies with CSM Replication
"/>




<link rel="preload" href="/csm-docs/scss/main.min.d0bfa16d819c9dab58324fe79e0fe1241c505038028e706c280c6fb590220afe.css" as="style">
<link href="/csm-docs/scss/main.min.d0bfa16d819c9dab58324fe79e0fe1241c505038028e706c280c6fb590220afe.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/csm-docs/">
		<span class="navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1017 132"><defs><style>.cls-1{fill:#fff}</style></defs><title>DellTech_Logo_Prm_Wht_rgb</title><path class="cls-1" d="M1015 84.89c0-12.23-6.8-17.66-20.39-20.38s-21.73-4.08-21.73-13.58c0-6.8 5.44-10.87 15-10.87 12.22.0 16.3 5.43 16.3 12.22l1.36 1.36h5.43l1.37-1.36c0-13.58-10.88-19-24.46-19-15 0-23.1 8.15-23.1 17.67.0 10.86 8.15 16.3 21.73 19s20.38 4.08 20.38 15c0 6.79-4.07 12.23-17.66 12.23-12.22.0-17.66-6.8-17.66-15l-1.35-1.36h-5.44l-1.35 1.36c0 12.23 9.5 21.74 25.8 21.74 17.66.0 25.82-8.15 25.82-19M956.58 71.31l1.36-1.37V65.87c0-19-10.87-32.61-29.89-32.61s-29.89 13.59-29.89 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38l-1.36-1.36h-5.43l-1.36 1.36c-2.72 8.15-8.16 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H907.67l-1.36-1.36c0-9.51 5.44-23.09 21.74-23.09s21.74 13.58 21.74 23.09zm-59.78 36.68V36l-1.36-1.35h-5.43L880.5 36v65.22l1.36 1.36h5.43zm0-78.8V14.24l-1.36-1.36h-5.43l-1.36 1.36v8.15l1.36 1.36h5.43zM837 97.12c-13.59.0-21.74-9.52-21.74-28.53S823.44 40.06 837 40.06s21.73 9.5 21.73 28.53S850.61 97.12 837 97.12M858.76 93c0 17.66-4.07 31.25-20.38 31.25-12.22.0-16.3-5.44-17.66-12.23l-1.35-1.36h-5.44l-1.36 1.36c1.36 10.87 9.51 19 25.81 19 17.67.0 28.53-10.87 28.53-38V36l-1.35-1.35h-4.08L860.12 36l-1.36 8.16H857.4c-2.71-5.43-9.5-10.87-21.74-10.87-19 0-28.53 15-28.53 35.33s9.52 35.32 28.53 35.32c12.24.0 19-5.43 21.74-10.87zm-88.3-53c13.58.0 23.09 10.87 23.09 28.53S784 97.12 770.46 97.12s-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32s-13.59-35.33-31.25-35.33-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-40.76-2.72V8.81l-1.36-1.36h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43zM680.8 40.06c13.58.0 23.09 10.87 23.09 28.53s-9.51 28.53-23.09 28.53-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32S698.46 33.26 680.8 33.26s-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-39.4-2.72V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.67 4.08-21.74 10.87h-1.36L592.49 36l-1.36-1.35h-4.08L585.7 36v65.22l1.35 1.36h5.44l1.36-1.36V64.51c0-15 6.79-24.45 21.73-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.37 1.36H640zm-69.29.0V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.66 4.08-21.74 10.87h-1.36V8.81L523.2 7.45h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43l1.36-1.36V64.51c0-15 6.8-24.45 21.74-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.36 1.36h5.44zM455.28 68.59c0-19 9.5-28.53 23.09-28.53s19 8.15 20.38 16.29l1.35 1.37h5.44l1.36-1.37c-1.36-13.58-12.23-23.09-28.53-23.09-17.66.0-31.24 10.87-31.24 35.33s13.58 35.32 31.24 35.32c16.3.0 27.17-9.51 28.53-23.1l-1.36-1.36H500.1l-1.35 1.36C497.39 89 492 97.12 478.37 97.12s-23.09-9.52-23.09-28.53m-14.95 2.72 1.36-1.37V65.87c0-19-10.87-32.61-29.9-32.61s-29.88 13.59-29.88 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38L439 82.17h-5.43l-1.36 1.36c-2.72 8.15-8.15 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H391.42l-1.36-1.36c0-9.51 5.44-23.09 21.73-23.09s21.75 13.58 21.75 23.09zM395.57 12.88V8.81l-1.36-1.36H323.56L322.2 8.81v4.07l1.36 1.36h29.89l1.36 1.36v85.59l1.36 1.36h5.43l1.36-1.36V15.6l1.36-1.36h29.89z"/><path class="cls-1" d="M322.2 83.65v18.9H260.85V7.45h21.6v76.2zM38.55 102.55A47.57 47.57.0 0084.58 67l53.8 42 53.77-42v35.56H253.5V83.65H213.75V7.45h-21.6V43L140.58 83.3l-11.54-9L153.73 55l26.89-21-15.35-12-51.58 40.3-11.53-9L153.73 13 138.38 1 84.58 43a47.57 47.57.0 00-46-35.58H0v95.1zM21.6 83.65V26.35H38.55c14.33.0 26 12.83 26 28.65s-11.67 28.65-26 28.65z"/></svg></span><span class="font-weight-bold">Dell Technologies</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/csm-docs/docs/" ><span>Dell Technologies (Dell) Container Storage Modules (CSM)</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/dell/csm" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/docs/">Current(v1.3)</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v1">v1.2.1</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v2">v1.2</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v3">v1.1</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/csm-docs/offline-search-index.1e79a0908736ce645e100ec566b3c5a3.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-default td-outer">
      <main role="main" class="td-main">
        

<h2 id="replication-cluster-topologies">Replication Cluster Topologies</h2>
<p>Container Storage Modules (CSM) for Replication project supports the replication of volumes within a single Kubernetes cluster or between two different
Kubernetes clusters. The replication controller can support multiple clusters at once, but a single volume can be replicated to a maximum of two clusters.</p>
<p>Each cluster should be assigned the unique identifier <code>clusterId</code>. The rules for naming are as follows:</p>
<ul>
<li>must be 63 characters or fewer (cannot be empty)</li>
<li>must begin and end with an alphanumeric character ([a-z, 0-9, A-Z])</li>
<li>could contain dashes (-), underscores (_), dots (.), and alphanumerics between</li>
<li>must be unique across clusters
``</li>
</ul>
<h3 id="single-cluster-replication">Single Cluster Replication</h3>
<h4 id="cluster-configuration">Cluster Configuration</h4>
<p>When configuring replication within a single cluster, you need to create a ConfigMap with at least the <code>clusterId</code>
field configured to point to the current cluster:</p>
<pre><code class="language-yaml">apiVersion: v1
data:
  config.yaml: |
    clusterId: cluster-A
    targets: []
kind: ConfigMap
metadata:
  name: dell-replication-controller-config
  namespace: dell-replication-controller
</code></pre>
<p>Note that the <code>targets</code> parameter is left empty since we don&rsquo;t require any target clusters to work within a single cluster.
This also means that you don&rsquo;t need to create any Secrets that contain connection information to such clusters, since in this use case, we
are limited to a single cluster.</p>
<p>You can find more info about configs and secrets for cluster communication in <a href="../deployment/configmap-secrets/">configmaps-secrets</a></p>
<h4 id="storage-class-configuration">Storage Class Configuration</h4>
<p>To create volumes that would be replicated within a single cluster, you need to create a special StorageClass.
This StorageClass should contain the usual replication parameter <code>replication.storage.dell.com/remoteClusterID</code>, and it should
be set to <code>self</code> to indicate that we want to replicate the volume inside the current cluster.</p>
<p>Also, you would need to create another storage class in the same cluster that would serve as a <code>target</code> storage class. This means that all replicated volumes would be derived from it. Its <code>replication.storage.dell.com/remoteClusterID</code> parameter should be also set to <code>self</code>.</p>
<p>You can find out more about replication StorageClasses and replication specific parameters in <a href="../deployment/storageclasses">storageclasses</a></p>
<h4 id="replicated-resources">Replicated Resources</h4>
<p>When creating PersistentVolumeClaims using StorageClass for a single cluster replication, replicated resources (PersistentVolumes,
ReplicationGroups) would be created in the same cluster with the <code>replicated-</code> prefix added to them.</p>
<p>Example:</p>
<pre><code class="language-shell">$ kubectl get pv 
NAME                           CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      STORAGECLASS                 AGE
csivol-06d51bfcc5              3Gi        RWO            Retain           Bound       powerstore-replication       23s
replicated-csivol-06d51bfcc5   3Gi        RWO            Retain           Available   powerstore-replication-tgt   23s
$ kubectl get rg
NAME                                                 AGE   STATE   LINK STATE     LAST LINKSTATE UPDATE
replicated-rg-240721b0-12fb-4151-8dd8-94794ae2493e   34s   Ready   SYNCHRONIZED   2021-08-03T11:23:18Z
rg-240721b0-12fb-4151-8dd8-94794ae2493e              34s   Ready   SYNCHRONIZED   2021-08-03T11:22:18Z
</code></pre>
<h3 id="multiple-cluster-replication">Multiple Cluster Replication</h3>
<h4 id="cluster-configuration-1">Cluster Configuration</h4>
<p>Similar to a single cluster scenario, you need to create ConfigMap, but this time you need to provide at least one target
cluster. You can provide as many as you like but be mindful that a single volume can be replicated to only one of them.</p>
<p>For example:</p>
<pre><code class="language-yaml">apiVersion: v1
data:
  config.yaml: |
    clusterId: cluster-A
    targets: 
      - clusterId: cluster-B
        address: 192.168.111.21
        secretRef: secretClusterB
kind: ConfigMap
metadata:
  name: dell-replication-controller-config
  namespace: dell-replication-controller
</code></pre>
<p>Note that target cluster information contains a field called <code>secretRef</code>. This field points to a secret available in the current cluster that contains connection information of <code>cluster-B</code> in the form of a kubeconfig file.</p>
<p>You can find more information about how to create such secrets in <a href="../deployment/configmap-secrets/#communication-between-clusters">configmaps-secrets</a></p>
<h4 id="storage-class-configuration-1">Storage Class Configuration</h4>
<p>To create replicated volumes in the multi-cluster configuration you still need to have a special storage class.
Replication parameter <code>replication.storage.dell.com/remoteClusterID</code> should be set to the cluster-id of whatever cluster you
want to replicate your volumes.</p>
<p>For multi-cluster replication, we can choose one of the target cluster ids we specified in
ConfigMap. In our example replication parameter, the target cluster id should be equal to <code>cluster-B</code>.</p>
<p>You can find more information about other replication parameters available in storage classes <a href="../deployment/storageclasses/#common-parameters">here</a></p>
<h4 id="replicated-resources-1">Replicated Resources</h4>
<p>When creating PersistentVolumeClaims using StorageClass for a multi-cluster replication, replicated resources would be
created in both <code>source</code> and <code>target</code> clusters under the same names.</p>
<p>Example:</p>
<pre><code class="language-shell">[CLUSTER-A]
$ kubectl get pv
NAME                           CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      STORAGECLASS                 AGE
csivol-06d51bfcc5              3Gi        RWO            Retain           Bound       powerstore-replication       23s
$ kubectl get rg
NAME                                      AGE   STATE   LINK STATE     LAST LINKSTATE UPDATE
rg-240721b0-12fb-4151-8dd8-94794ae2493e   34s   Ready   SYNCHRONIZED   2021-08-03T11:22:18Z
</code></pre>
<pre><code class="language-shell">[CLUSTER-B]
$ kubectl get pv
NAME                           CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS          STORAGECLASS                 AGE
csivol-06d51bfcc5              3Gi        RWO            Retain           Available       powerstore-replication       18s
$ kubectl get rg
NAME                                      AGE   STATE   LINK STATE     LAST LINKSTATE UPDATE
rg-240721b0-12fb-4151-8dd8-94794ae2493e   30s   Ready   SYNCHRONIZED   2021-08-03T11:22:18Z
</code></pre>



      </main>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/dell/csm" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="http://del.ly/Slack_request" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Dell Technologies All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.dell.com/learn/us/en/uscorp1/policies-privacy" target="_blank" rel="noopener">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/csm-docs/js/main.min.9f90c5deff5c6f69d5eaaf614a76a233d8b0b3ae70b942fc78919b6d08041034.js" integrity="sha256-n5DF3v9cb2nV6q9hSnaiM9iws65wuUL8eJGbbQgEEDQ=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>