<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.103.1" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/csm-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/csm-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/csm-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/csm-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/csm-docs/favicons/android-192x192.png" sizes="192x192">

<title>Unity | Dell Technologies</title>
<meta name="description" content="Code features for Unity Driver">
<meta property="og:title" content="Unity" />
<meta property="og:description" content="Code features for Unity Driver" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dell.github.io/csm-docs/v2/csidriver/features/unity/" /><meta property="article:section" content="v2" />

<meta property="article:modified_time" content="2022-06-22T16:36:23+05:30" /><meta property="og:site_name" content="Dell Technologies" />

<meta itemprop="name" content="Unity">
<meta itemprop="description" content="Code features for Unity Driver">
<meta itemprop="dateModified" content="2022-06-22T16:36:23+05:30" />
<meta itemprop="wordCount" content="2805">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unity"/>
<meta name="twitter:description" content="Code features for Unity Driver"/>




<link rel="preload" href="/csm-docs/scss/main.min.d0bfa16d819c9dab58324fe79e0fe1241c505038028e706c280c6fb590220afe.css" as="style">
<link href="/csm-docs/scss/main.min.d0bfa16d819c9dab58324fe79e0fe1241c505038028e706c280c6fb590220afe.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/csm-docs/">
		<span class="navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1017 132"><defs><style>.cls-1{fill:#fff}</style></defs><title>DellTech_Logo_Prm_Wht_rgb</title><path class="cls-1" d="M1015 84.89c0-12.23-6.8-17.66-20.39-20.38s-21.73-4.08-21.73-13.58c0-6.8 5.44-10.87 15-10.87 12.22.0 16.3 5.43 16.3 12.22l1.36 1.36h5.43l1.37-1.36c0-13.58-10.88-19-24.46-19-15 0-23.1 8.15-23.1 17.67.0 10.86 8.15 16.3 21.73 19s20.38 4.08 20.38 15c0 6.79-4.07 12.23-17.66 12.23-12.22.0-17.66-6.8-17.66-15l-1.35-1.36h-5.44l-1.35 1.36c0 12.23 9.5 21.74 25.8 21.74 17.66.0 25.82-8.15 25.82-19M956.58 71.31l1.36-1.37V65.87c0-19-10.87-32.61-29.89-32.61s-29.89 13.59-29.89 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38l-1.36-1.36h-5.43l-1.36 1.36c-2.72 8.15-8.16 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H907.67l-1.36-1.36c0-9.51 5.44-23.09 21.74-23.09s21.74 13.58 21.74 23.09zm-59.78 36.68V36l-1.36-1.35h-5.43L880.5 36v65.22l1.36 1.36h5.43zm0-78.8V14.24l-1.36-1.36h-5.43l-1.36 1.36v8.15l1.36 1.36h5.43zM837 97.12c-13.59.0-21.74-9.52-21.74-28.53S823.44 40.06 837 40.06s21.73 9.5 21.73 28.53S850.61 97.12 837 97.12M858.76 93c0 17.66-4.07 31.25-20.38 31.25-12.22.0-16.3-5.44-17.66-12.23l-1.35-1.36h-5.44l-1.36 1.36c1.36 10.87 9.51 19 25.81 19 17.67.0 28.53-10.87 28.53-38V36l-1.35-1.35h-4.08L860.12 36l-1.36 8.16H857.4c-2.71-5.43-9.5-10.87-21.74-10.87-19 0-28.53 15-28.53 35.33s9.52 35.32 28.53 35.32c12.24.0 19-5.43 21.74-10.87zm-88.3-53c13.58.0 23.09 10.87 23.09 28.53S784 97.12 770.46 97.12s-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32s-13.59-35.33-31.25-35.33-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-40.76-2.72V8.81l-1.36-1.36h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43zM680.8 40.06c13.58.0 23.09 10.87 23.09 28.53s-9.51 28.53-23.09 28.53-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32S698.46 33.26 680.8 33.26s-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-39.4-2.72V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.67 4.08-21.74 10.87h-1.36L592.49 36l-1.36-1.35h-4.08L585.7 36v65.22l1.35 1.36h5.44l1.36-1.36V64.51c0-15 6.79-24.45 21.73-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.37 1.36H640zm-69.29.0V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.66 4.08-21.74 10.87h-1.36V8.81L523.2 7.45h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43l1.36-1.36V64.51c0-15 6.8-24.45 21.74-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.36 1.36h5.44zM455.28 68.59c0-19 9.5-28.53 23.09-28.53s19 8.15 20.38 16.29l1.35 1.37h5.44l1.36-1.37c-1.36-13.58-12.23-23.09-28.53-23.09-17.66.0-31.24 10.87-31.24 35.33s13.58 35.32 31.24 35.32c16.3.0 27.17-9.51 28.53-23.1l-1.36-1.36H500.1l-1.35 1.36C497.39 89 492 97.12 478.37 97.12s-23.09-9.52-23.09-28.53m-14.95 2.72 1.36-1.37V65.87c0-19-10.87-32.61-29.9-32.61s-29.88 13.59-29.88 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38L439 82.17h-5.43l-1.36 1.36c-2.72 8.15-8.15 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H391.42l-1.36-1.36c0-9.51 5.44-23.09 21.73-23.09s21.75 13.58 21.75 23.09zM395.57 12.88V8.81l-1.36-1.36H323.56L322.2 8.81v4.07l1.36 1.36h29.89l1.36 1.36v85.59l1.36 1.36h5.43l1.36-1.36V15.6l1.36-1.36h29.89z"/><path class="cls-1" d="M322.2 83.65v18.9H260.85V7.45h21.6v76.2zM38.55 102.55A47.57 47.57.0 0084.58 67l53.8 42 53.77-42v35.56H253.5V83.65H213.75V7.45h-21.6V43L140.58 83.3l-11.54-9L153.73 55l26.89-21-15.35-12-51.58 40.3-11.53-9L153.73 13 138.38 1 84.58 43a47.57 47.57.0 00-46-35.58H0v95.1zM21.6 83.65V26.35H38.55c14.33.0 26 12.83 26 28.65s-11.67 28.65-26 28.65z"/></svg></span><span class="font-weight-bold">Dell Technologies</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/csm-docs/docs/" ><span>Dell Technologies (Dell) Container Storage Modules (CSM)</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/dell/csm" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/docs/">Current(v1.3)</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v1">v1.2.1</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v2">v1.2</a>
	
	<a class="dropdown-item" href="https://dell.github.io/csm-docs/v3">v1.1</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/csm-docs/offline-search-index.1e79a0908736ce645e100ec566b3c5a3.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-default td-outer">
      <main role="main" class="td-main">
        

<h2 id="creating-volumes-and-consuming-them">Creating volumes and consuming them</h2>
<p>Create a file <code>sample.yaml</code> using sample yaml files located at test/sample.yaml</p>
<p>The following command creates a statefulset that consumes three volumes of default storage classes:</p>
<pre><code class="language-bash">kubectl create -f test/sample.yaml
</code></pre>
<p>After executing this command 3 PVC and statefulset are created in the <code>test-unity</code> namespace.
You can check created PVCs by running <code>kubectl get pvc -n test-unity</code> and check statefulset&rsquo;s pods by running <code>kubectl get pods -n test-unity</code> command.
The pod should be <code>Ready</code> and <code>Running</code>.</p>
<blockquote>
<p>If Pod is in CrashLoopback or PVCs is in a Pending state then driver installation is not successful, check logs of node and controller.</p>
</blockquote>
<h2 id="deleting-volumes">Deleting volumes</h2>
<p>To delete volumes, pod and statefulset run the command</p>
<pre><code class="language-bash">kubectl delete -f test/sample.yaml
</code></pre>
<h2 id="consuming-existing-volumes-with-static-provisioning">Consuming existing volumes with static provisioning</h2>
<p>You can use existent volumes from Unity array as Persistent Volumes in your Kubernetes, to do that you must perform the following steps:</p>
<ol>
<li>Open your volume in Unity Management UI (Unisphere), and take a note of volume-id. The <code>volume-id</code> looks like <code>csiunity-xxxxx</code> and CLI ID looks like <code>sv_xxxx</code>.</li>
<li>Create PersistentVolume and use this volume-id as a volumeHandle in the manifest. Modify other parameters according to your needs.</li>
</ol>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolume
metadata:
    name: static-1
    annotations:
       pv.kubernetes.io/provisioned-by: csi-unity.dellemc.com
spec:
    accessModes:
      - ReadWriteOnce
    capacity:
        storage: 5Gi
    csi:
        driver: csi-unity.dellemc.com
        volumeHandle: existingvol-&lt;protocol&gt;-&lt;array_id&gt;-&lt;volume-id&gt;
    persistentVolumeReclaimPolicy: Retain
    claimRef:
      namespace: default
      name: static-pvc1
    storageClassName: unity
    volumeMode: Filesystem
</code></pre>
<ol start="3">
<li>Create PersistentVolumeClaim to use this PersistentVolume.</li>
</ol>
<pre><code class="language-yaml">kind: PersistentVolumeClaim                
apiVersion: v1                             
metadata:                                  
  name: static-pvc1                        
spec:                                      
  accessModes:                             
    - ReadWriteMany                        
  resources:                               
    requests:                              
      storage: 5Gi                         
  volumeName: static-1                     
  storageClassName: unity            
</code></pre>
<ol start="4">
<li>Then use this PVC as a volume in a pod.</li>
</ol>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
    name: static-prov-pod
spec:
    containers:
      - name: test
        image: docker.io/centos:latest
        command: [ &quot;/bin/sleep&quot;, &quot;3600&quot; ]
        volumeMounts:
          - mountPath: &quot;/data0&quot;
            name: pvol
    volumes:
      - name: pvol
        persistentVolumeClaim:
            claimName: static-pvc1
</code></pre>
<ol start="5">
<li>After the pod becomes <code>Ready</code> and <code>Running</code>, you can start to use this pod and volume.</li>
</ol>
<h2 id="volume-snapshot-feature">Volume Snapshot Feature</h2>
<p>In order to use Volume Snapshots, ensure the following components have been deployed to your cluster:</p>
<ul>
<li>Kubernetes Volume Snapshot CRDs</li>
<li>Volume Snapshot Controller</li>
</ul>
<h3 id="volume-snapshot-class">Volume Snapshot Class</h3>
<p>During the installation of the CSI Unity 2.0 driver and higher, a Volume Snapshot Class is not created and need to create  Volume Snapshot Class.</p>
<p>Following is the manifest to create Volume Snapshot Class :</p>
<pre><code class="language-yaml">apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: unity-snapclass
driver: csi-unity.dellemc.com
deletionPolicy: Delete
</code></pre>
<h3 id="create-volume-snapshot">Create Volume Snapshot</h3>
<p>The following is a sample manifest for creating a Volume Snapshot using the <strong>v1</strong> snapshot APIs:</p>
<pre><code class="language-yaml">apiVersion: snapshot.storage.k8s.io/v1 
kind: VolumeSnapshot
metadata:
  name: pvol0-snap
  namespace: test-unity
spec:
  volumeSnapshotClassName: unity-snapclass
  source:
    persistentVolumeClaimName: pvol
</code></pre>
<p>Once the status of the VolumeSnapshot object has the <em>readyToUse</em> field set to <em>true</em>, it is available for use.</p>
<p>Following is the relevant section of VolumeSnapshot object status:</p>
<pre><code class="language-yaml">status:
  boundVolumeSnapshotContentName: snapcontent-xxxxxxxxxxxxx
  creationTime: &quot;2020-07-16T08:42:12Z&quot;
  readyToUse: true
</code></pre>
<p>Note : 
For CSI Driver for Unity version 1.6 and later, <code>dell-csi-helm-installer</code> does not create any Volume Snapshot  classes as part of the driver installation. A  set of annotated volume snapshot class manifests have been provided in the <code>csi-unity/samples/volumesnapshotclass/</code> folder. Use these samples to create new Volume Snapshot to provision storage.</p>
<h3 id="creating-pvcs-with-volume-snapshots-as-source">Creating PVCs with Volume Snapshots as Source</h3>
<p>The following is a sample manifest for creating a PVC with a VolumeSnapshot as a source:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: restorepvc
  namespace: test-unity
spec:
  storageClassName: unity-iscsi
  dataSource:
    name: pvol0-snap
    kind: VolumeSnapshot
    apiGroup: snapshot.storage.k8s.io
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 8Gi
</code></pre>
<h2 id="volume-expansion">Volume Expansion</h2>
<p>The CSI Unity driver version 1.3 and later supports the expansion of Persistent Volumes (PVs). This expansion can be done either online (for example, when a PVC is attached to a node) or offline (for example, when a PVC is not attached to any node).</p>
<p>To use this feature, the storage class that is used to create the PVC must have the attribute <code>allowVolumeExpansion</code> set to true.</p>
<p>The following is a sample manifest for a storage class that allows for Volume Expansion:</p>
<pre><code class="language-yaml">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
    name: unity-expand-sc
    annotations:
        storageclass.kubernetes.io/is-default-class: false
provisioner: csi-unity.dellemc.com
reclaimPolicy: Delete
allowVolumeExpansion: true # Set this attribute to true if you plan to expand any PVCs created using this storage class
parameters:
    csi.storage.k8s.io/fstype: &quot;xfs&quot;
</code></pre>
<p>To resize a PVC, edit the existing PVC spec and set spec.resources.requests.storage to the intended size. For example, if you have a PVC unity-pvc-demo of size 3Gi, then you can resize it to 30Gi by updating the PVC.</p>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
    name: unity-pvc-demo
    namespace: test
spec:
    accessModes:
      - ReadWriteOnce
    volumeMode: Filesystem
    resources:
        requests:
            storage: 30Gi # Updated size from 3Gi to 30Gi
    storageClassName: unity-expand-sc
</code></pre>
<blockquote>
<p>The Kubernetes Volume Expansion feature can only be used to increase the size of a volume. It cannot be used to shrink a volume.</p>
</blockquote>
<h2 id="raw-block-support">Raw block support</h2>
<p>The CSI Unity driver supports Raw Block Volumes.
Raw Block volumes are created using the volumeDevices list in the pod template spec with each entry accessing a volumeClaimTemplate specifying a volumeMode: Block. The following is an example configuration:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rawblockpvc
  namespace: default
spec:
  accessModes:
  - ReadWriteOnce
  volumeMode: Block  
  resources:
        requests:
          storage: 5Gi
  storageClassName: unity-iscsi
	  
</code></pre>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: rawblockpod
  namespace: default
spec:
  containers:
    - name: task-pv-container
      image: nginx
      ports:
        - containerPort: 80
          name: &quot;http-server&quot;
      volumeDevices:
        - devicePath: /usr/share/nginx/html/device
          name: nov-eleventh-1-pv-storage
  volumes:
    - name: nov-eleventh-1-pv-storage
      persistentVolumeClaim:
        claimName: rawblockpvc
</code></pre>
<p>Access modes allowed are ReadWriteOnce and ReadWriteMany. Raw Block volumes are presented as a block device to the pod by using a bind mount to a block device in the node&rsquo;s file system. The driver does not format or check the format of any file system on the block device.</p>
<p>Raw Block volumes support online Volume Expansion, but it is up to the application to manage to reconfigure the file system (if any) to the new size. Access mode ReadOnlyMany is not supported with raw block since we cannot restrict volumes to be readonly from Unity.</p>
<p>For additional information, see the <a href="https://kubernetes.io/DOCS/CONCEPTS/STORAGE/PERSISTENT-VOLUMES/#volume-mode">kubernetes</a> website.</p>
<h2 id="volume-cloning-feature">Volume Cloning Feature</h2>
<p>The CSI Unity driver version 1.3 and later supports volume cloning. This allows specifying existing PVCs in the <em>dataSource</em> field to indicate a user would like to clone a Volume.</p>
<p>Source and destination PVC must be in the same namespace and have the same Storage Class.</p>
<p>To clone a volume, you should first have an existing PVC, example: vol0:</p>
<pre><code class="language-yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: vol0
  namespace: test-unity
spec:
  storageClassName: unity-nfs
  accessModes:
  - ReadWriteOnce
  volumeMode: Filesystem
  resources:
    requests:
      storage: 8Gi
</code></pre>
<p>The following is a sample manifest for cloning pvol0:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: cloned-pvc
  namespace: test-unity
spec:
  storageClassName: unity-nfs
  dataSource:
    name: vol0
    kind: PersistentVolumeClaim
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 8Gi
</code></pre>
<h2 id="ephemeral-inline-volume">Ephemeral Inline Volume</h2>
<p>The CSI Unity driver supports ephemeral inline CSI volumes. This feature allows CSI volumes to be specified directly in the pod specification.</p>
<p>At runtime, nested inline volumes follow the ephemeral lifecycle of their associated pods where the driver handles all phases of volume operations as pods are created and destroyed.</p>
<p>The following is a sample manifest for creating ephemeral volume in pod manifest with CSI Unity driver.</p>
<pre><code class="language-yaml">kind: Pod
apiVersion: v1
metadata:
  name: test-unity-ephemeral-volume
spec:
  containers:
    - name: test-container
      image: busybox
      command: [ &quot;sleep&quot;, &quot;3600&quot; ]
      volumeMounts:
      - mountPath: &quot;/data&quot;
        name: volume
  volumes:
  - name: volume
    csi:
      driver: csi-unity.dellemc.com
      fsType: &quot;ext4&quot;
      volumeAttributes:
        size: &quot;10Gi&quot;
        arrayId: APM************
        protocol: iSCSI
        thinProvisioned: &quot;true&quot;
        isDataReductionEnabled: &quot;false&quot;
        tieringPolicy: &quot;1&quot;
        storagePool: pool_2
</code></pre>
<p>This manifest creates a pod and attaches a newly created ephemeral inline CSI volume to it.</p>
<p>To create <code>NFS</code> volume you need to provide <code>nasName:</code> parameters that point to the name of your NAS Server in pod manifest like so</p>
<pre><code class="language-yaml">  volumes:
  - name: volume
    csi:
      driver: csi-unity.dellemc.com
      csi.storage.k8s.io/fstype: &quot;nfs&quot;
      volumeAttributes:
        size: &quot;20Gi&quot;
        nasName: &quot;csi-nas-name&quot;
</code></pre>
<h2 id="controller-ha">Controller HA</h2>
<p>The CSI Unity driver supports controller HA feature. Instead of StatefulSet controller pods deployed as a Deployment.</p>
<p>By default, number of replicas is set to 2, you can set the <code>controllerCount</code> parameter to 1 in <code>myvalues.yaml</code> if you want to disable controller HA for your installation. When installing via Operator you can change the <code>replicas</code> parameter in the <code>spec.driver</code> section in your Unity Custom Resource.</p>
<p>When multiple replicas of controller pods are in a cluster each sidecar (Attacher, Provisioner, Resizer, and Snapshotter) tries to get a lease so only one instance of each sidecar is active in the cluster at a time.</p>
<h3 id="driver-pod-placement">Driver pod placement</h3>
<p>You can configure where driver controller and worker pods should be placed. 
To do that you will need to use <code>nodeSelector</code> and <code>tolerations</code> mechanisms you can configure in your <code>myvalues.yaml</code></p>
<p>For example you can specify <code>tolerations</code> to assign driver controller pods on controller nodes too:</p>
<pre><code class="language-yaml"># &quot;controller&quot; allows to configure controller specific parameters
controller:
  # &quot;controller.nodeSelector&quot; defines what nodes would be selected for pods of controller deployment
  nodeSelector:

# &quot;controller.tolerations&quot; defines tolerations that would be applied to controller deployment
  tolerations:
   - key: &quot;node-role.kubernetes.io/master&quot;
     operator: &quot;Exists&quot;
     effect: &quot;NoSchedule&quot;
</code></pre>
<p>If you want to assign controller pods ONLY on controller nodes you need to configure <code>nodeSelector</code>:</p>
<pre><code class="language-yaml"># &quot;controller&quot; allows to configure controller specific parameters
controller:
  # &quot;controller.nodeSelector&quot; defines what nodes would be selected for pods of controller deployment
  nodeSelector:
    node-role.kubernetes.io/master: &quot;&quot;

  # &quot;controller.tolerations&quot; defines tolerations that would be applied to controller deployment
  tolerations:
   - key: &quot;node-role.kubernetes.io/master&quot;
     operator: &quot;Exists&quot;
     effect: &quot;NoSchedule&quot;
</code></pre>
<p>As said before you can configure where node driver pods would be assigned in a similar way in the <code>node</code> section of <code>myvalues.yaml</code></p>
<h2 id="topology">Topology</h2>
<p>The CSI Unity driver supports Topology which forces volumes to be placed on worker nodes that have connectivity to the backend storage. This covers use cases where users have chosen to restrict the nodes on which the CSI driver is deployed.</p>
<p>This Topology support does not include customer-defined topology, users cannot create their own labels for nodes, they should use whatever labels are returned by the driver and applied automatically by Kubernetes on its nodes.</p>
<h3 id="topology-usage">Topology Usage</h3>
<p>User can create custom storage classes on their own by specifying the valid topology keys and binding mode.</p>
<p>The following is one of example storage class manifest:</p>
<pre><code class="language-yaml">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: unity-topology-fc
provisioner: csi-unity.dellemc.com
reclaimPolicy: Delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
allowedTopologies:
  - matchLabelExpressions:
      - key: csi-unity.dellemc.com/&lt;array_id&gt;-fc
        values:
          - &quot;true&quot;
</code></pre>
<p>This example matches all nodes where the driver has a connection to the Unity array with array ID mentioned via Fiber Channel. Similarly, by replacing <code>fc</code> with <code>iscsi</code> in the key checks for iSCSI connectivity with the node.</p>
<p>You can check what labels your nodes contain by running <code>kubectl get nodes --show-labels</code> command.</p>
<blockquote>
<p>Note that <code>volumeBindingMode:</code> is set to <code>WaitForFirstConsumer</code> this is required for the topology feature to work properly.</p>
</blockquote>
<p>For any additional information about the topology, see the <a href="https://kubernetes-csi.github.io/docs/topology.html">Kubernetes Topology documentation</a>.</p>
<h2 id="volume-limit">Volume Limit</h2>
<p>The CSI Driver for Dell Unity allows users to specify the maximum number of Unity volumes that can be used in a node.</p>
<p>The user can set the volume limit for a node by creating a node label <code>max-unity-volumes-per-node</code> and specifying the volume limit for that node.
<br/> <code>kubectl label node &lt;node_name&gt; max-unity-volumes-per-node=&lt;volume_limit&gt;</code></p>
<p>The user can also set the volume limit for all the nodes in the cluster by specifying the same to <code>maxUnityVolumesPerNode</code> attribute in values.yaml file.</p>
<blockquote>
<p><strong>NOTE:</strong> <br>To reflect the changes after setting the value either via node label or in values.yaml file, user has to bounce the driver controller and node pods using the command <code>kubectl get pods -n unity --no-headers=true | awk '/unity-/{print $1}'| xargs kubectl delete -n unity pod</code>. <br><br> If the value is set both by node label and values.yaml file then node label value will get the precedence and user has to remove the node label in order to reflect the values.yaml value. <br><br>The default value of <code>maxUnityVolumesPerNode</code> is 0. <br><br>If <code>maxUnityVolumesPerNode</code> is set to zero, then Container Orchestration decides how many volumes of this type can be published by the controller to the node.<br><br>The volume limit specified to <code>maxUnityVolumesPerNode</code> attribute is applicable to all the nodes in the cluster for which node label <code>max-unity-volumes-per-node</code> is not set.</p>
</blockquote>
<h2 id="nat-support">NAT Support</h2>
<p>CSI Driver for Dell Unity is supported in the NAT environment for NFS protocol.</p>
<p>The user will be able to install the driver and able to create pods.</p>
<h2 id="single-pod-access-mode-for-persistentvolumes">Single Pod Access Mode for PersistentVolumes</h2>
<p>CSI Driver for Unity supports a new accessmode <code>ReadWriteOncePod</code> for PersistentVolumes and PersistentVolumeClaims. With this feature, CSI Driver for Unity allows to restrict volume access to a single pod in the cluster</p>
<p>Prerequisites</p>
<ol>
<li>Enable the ReadWriteOncePod feature gate for kube-apiserver, kube-scheduler, and kubelet as the ReadWriteOncePod access mode is in alpha for Kubernetes v1.22 and is only supported for CSI volumes. You can enable the feature by setting command line arguments:
<code>--feature-gates=&quot;...,ReadWriteOncePod=true&quot;</code></li>
<li>Create a PVC with access mode set to ReadWriteOncePod like shown in the sample below</li>
</ol>
<pre><code class="language-yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: single-writer-only
spec:
  accessModes:
  - ReadWriteOncePod # Allow only a single pod to access single-writer-only.
  resources:
    requests:
      storage: 1Gi
</code></pre>
<h2 id="volume-health-monitoring">Volume Health Monitoring</h2>
<p>CSI Driver for Unity supports volume health monitoring. This is an alpha feature and requires feature gate to be enabled by setting command line arguments <code>--feature-gates=&quot;...,CSIVolumeHealth=true&quot;</code>.<br>
This feature:</p>
<ol>
<li>Reports on the condition of the underlying volumes via events when a volume condition is abnormal. We can watch the events on the describe of pvc <code>kubectl describe pvc &lt;pvc name&gt; -n &lt;namespace&gt;</code></li>
<li>Collects the volume stats. We can see the volume usage in the node logs <code>kubectl logs &lt;nodepod&gt; -n &lt;namespacename&gt; -c driver</code>
By default this is disabled in CSI Driver for Unity. You will have to set the <code>healthMonitor.enable</code> flag for controller, node or for both in <code>values.yaml</code> to get the volume stats and volume condition.</li>
</ol>
<h2 id="dynamic-logging-configuration">Dynamic Logging Configuration</h2>
<p>This feature is introduced in CSI Driver for unity version 2.0.0.</p>
<h3 id="helm-based-installation">Helm based installation</h3>
<p>As part of driver installation, a ConfigMap with the name <code>unity-config-params</code> is created, which contains an attribute <code>CSI_LOG_LEVEL</code> which specifies the current log level of CSI driver.</p>
<p>Users can set the default log level by specifying log level to <code>logLevel</code> attribute in values.yaml during driver installation.</p>
<p>To change the log level dynamically to a different value user can edit the same values.yaml, and run the following command</p>
<pre><code>cd dell-csi-helm-installer
./csi-install.sh --namespace unity --values ./myvalues.yaml --upgrade
</code></pre>
<p>Note: myvalues.yaml is a values.yaml file which user has used for driver installation.</p>
<h3 id="operator-based-installation">Operator based installation</h3>
<p>As part of driver installation, a ConfigMap with the name <code>unity-config-params</code> is created using the manifest located in the sample file. This ConfigMap contains an attribute <code>CSI_LOG_LEVEL</code> which specifies the current log level of the CSI driver. To set the default/initial log level user can set this field during driver installation.</p>
<p>To update the log level dynamically user has to edit the ConfigMap <code>unity-config-params</code> and update <code>CSI_LOG_LEVEL</code> to the desired log level.</p>
<pre><code>kubectl edit configmap -n unity unity-config-params
</code></pre>
<blockquote>
<p>Note: Prior to CSI Driver for unity version 2.0.0, the log level was allowed to be updated dynamically through <code>logLevel</code> attribute in the secret object.</p>
</blockquote>
<h2 id="tenancy-support-for-unity-nfs">Tenancy support for Unity NFS</h2>
<p>The CSI Unity driver version 2.1.0 (and later versions) supports the Tenancy feature of Unity such that the user will be able to associate specific worker nodes (in the cluster) and NFS storage volumes with Tenant.</p>
<p>Prerequisites (to be manually created in Unity Array) before the driver installation:</p>
<ul>
<li>Create Tenants</li>
<li>Create Pools</li>
<li>Create NAS Servers with Tenant and Pool mapping</li>
</ul>
<p>The following example describes the usage of Tenant in the NFS pod creation:</p>
<p>Install the csi driver using myvalues.yaml with the TenantName as follows:
Example <em>myvalues.yaml</em></p>
<pre><code class="language-yaml">logLevel: &quot;info&quot;
certSecretCount: 1
kubeletConfigDir: /var/lib/kubelet
controller:
    controllerCount: 2
    volumeNamePrefix : csivol
snapshot:
    snapNamePrefix: csi-snap
tenantName: &quot;tenant3&quot;
</code></pre>
<p>Create storageclass with NAS-Server and the Storage-Pool associated with TenantName as follows:
Example <em>storageclass.yaml</em></p>
<pre><code class="language-yaml">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
    annotations:
        storageclass.kubernetes.io/is-default-class: &quot;false&quot;
    name: unity-nfs
parameters:
    arrayId: &quot;APM0***XXXXXX&quot;
    hostIoSize: &quot;16384&quot;
    isDataReductionEnabled: &quot;false&quot;
    storagePool: pool_7
    thinProvisioned: &quot;true&quot;
    tieringPolicy: &quot;0&quot;
    protocol: &quot;NFS&quot;
    nasServer: &quot;nas_5&quot;
    provisioner: csi-unity.dellemc.com
    reclaimPolicy: Delete
    volumeBindingMode: WaitForFirstConsumer
    allowVolumeExpansion: true
</code></pre>
<p>Create the pod and pvc as follows:
Example <em>pvc.yaml</em></p>
<pre><code class="language-yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
    name: pvcname
    namespace: nginx
spec:
    accessModes:
    - ReadWriteOnce
 	volumeMode: Filesystem
 	resources:
  		requests:
  		storage: 2Gi
  	storageClassName: unity-nfs
</code></pre>
<p>Example <em>pod.yaml</em></p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata: 
  name: podname
  namespace: nginx
spec: 
  replicas: 1
  selector: 
    matchLabels: 
      app: podname
  template: 
    metadata: 
      labels: 
        app: podname
    spec: 
      containers: 
        - 
          args: 
            - &quot;-c&quot;
            - &quot;while true; do dd if=/dev/urandom of=/data0/foo bs=1M count=1;done&quot;
          command: 
            - /bin/bash
          image: &quot;docker.io/centos:latest&quot;
          name: test
          volumeMounts: 
            - 
              mountPath: /data0
              name: pvcname
      volumes: 
        - 
          name: pvolx0
          persistentVolumeClaim: 
            claimName: pvcname
</code></pre>
<p>With the usage shown in the example, the user will be able to create an NFS pod with PVC using the NAS and the Pool associated with the added Tenants specified in SC.</p>
<blockquote>
<p>Note: Current feature supports <strong>ONLY single Tenant</strong> for all the nodes in the cluster.
Users may expect an error if PVC is created from the NAS server whose pool is mapped to the different tenants not associated with this SC.</p>
</blockquote>
<p>For operator based installation, mention the TENANT_NAME in configmap as shown in the following example:
Example <em>configmap.yaml</em></p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: unity-config-params
  namespace: test-unity
data:
  driver-config-params.yaml: |
    CSI_LOG_LEVEL: &quot;info&quot;
    ALLOW_RWO_MULTIPOD_ACCESS: &quot;false&quot;
    MAX_UNITY_VOLUMES_PER_NODE: &quot;0&quot;
    SYNC_NODE_INFO_TIME_INTERVAL: &quot;15&quot;
    TENANT_NAME: &quot;&quot;
</code></pre>
<blockquote>
<p>Note: csi-unity supports Tenancy in multi-array setup, provided the TenantName is the same across Unity instances.</p>
</blockquote>



      </main>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/dell/csm" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="http://del.ly/Slack_request" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Dell Technologies All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.dell.com/learn/us/en/uscorp1/policies-privacy" target="_blank" rel="noopener">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/csm-docs/js/main.min.9f90c5deff5c6f69d5eaaf614a76a233d8b0b3ae70b942fc78919b6d08041034.js" integrity="sha256-n5DF3v9cb2nV6q9hSnaiM9iws65wuUL8eJGbbQgEEDQ=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>